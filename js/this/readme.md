# JS 中 this的设计

## 自由变量的查找
- 编译阶段 
- 作用域链
- Lexical Scope（词法作用域）

## 如果要拿到time.geekbang.com 怎么办？
- this
    在面向对象的方法内**应该**可以通过this 拿到对象的属性
    但是早期没有class，函数里面需要this 来完成OOP

- js 做了一个不好的设计
    this 由函数的调用方式决定的
       - 调用对象内的函数，this 就指向在对象中
       - let 申明的变量，不会挂载在全局window对象上
        不好的地方：
       - var 申明的变量，会挂载在全局window对象上
       - 当函数没有调用对象，就是普通函数，this 就指向全局对象（window）
            多次使用var会导致很多冲突且难管理（全局变量的污染），将window污染了
            例如：
                function bar() {}
                var bar = 123;（调用bar就会导致后面的bar将前面的bar覆盖了）
- 解决方法：
    用 严格模式（'use strict'）
       - js 执行机制跟编译阶段挂钩
            变量环境 词法环境 outer都在编译阶段
       - this 是个例外，由调用方式决定 
            this 是个指针，指向调用他的对象（调用就一定是在执行阶段）
            谁调用这个方法，this就指向谁

代码执行的阶段
    编译阶段 -> 创建执行上下文 -> 执行阶段
        编译阶段（Compilation）
            词法分析、作用域/变量收集
            生成字节码 / 机器码（不同引擎略有差异）
        创建执行上下文（Creation Phase）
            建立全局/函数执行上下文
            创建词法环境 / 变量环境
            变量、函数声明“提升”（只声明、不执行）
        执行阶段（Execution Phase）
            按顺序一行一行执行语句
            运行函数调用、计算表达式、操作对象、修改内存等
            this 绑定、闭包生效、事件回调、异步任务等都在这一步里发生

## this 指向的各种情况
- 作为对象的方法被调用，指向对象
- 作为普通函数被调用，指向全局对象，严格模式下为 undefined
- call apply 绑定this
- 构造函数 this 指向实例
- 事件处理函数 this 指向事件绑定的元素